# Static OMR Coordinates & Slim Overlay API Walkthrough

## Changes Implemented

### Database
- **New Table:** `omr_template_header_coordinates`
    - Stores static coordinates for the header section (Class Level, Group, Exam Center, Student Roll).
    - Populated using data from a sample sheet's `id_bubble_positions`.

### Scripts
- **New Script:** [scripts/generate_omr_layout.py](file:///workspaces/omr-backend/scripts/generate_omr_layout.py)
    - Generates `omr-layout.json` containing static coordinates for both header and questions.
    - This file is intended to be used by the frontend to render the overlay.

### API
- **New Endpoint:** `GET /sheets/layout`
    - Returns the static OMR layout configuration (header and questions coordinates).
    - Replaces the need for a static JSON file generated by script.
- **New Endpoint:** `GET /tasks/{task_id}/answer-key`
    - Returns the correct answers (Answer Key) for a given task.
    - Format: `{ "1": 2, "2": 4, ... }`
- **Updated Endpoint:** `GET /sheets/{id}/overlay`
    - Removed static data to reduce payload size.
    - **Top Part:** Removed `markers`.
    - **Bottom Part:** Removed `x`, `y`, `cx`, `cy`, `c_val`.

## Verification Results

### Overlay Endpoint
Request: `GET /sheets/902985/overlay`
Response (Slimmed):
```json
{
  "top": {
    "dimensions": { "w": 1440, "h": 595 },
    "values": {
      "class_level": 1,
      "class_group": 2,
      "exam_center": 121001,
      "student_roll": 20002
    },
    "scores": { "subject1": 0, "subject2": 0, "subject3": 0 }
  },
  "bottom": {
    "dimensions": { "w": 1170, "h": 1650 },
    "answers": [
      { "q": 1, "val": null },
      ...
    ]
  }
}
```
The response no longer contains redundant coordinate data, significantly reducing the payload size.

### Answer Key Endpoint
Request: `GET /tasks/902985/answer-key`
Result: `403 Forbidden` (Expected without auth token, confirms endpoint is protected and reachable).

### Layout Endpoint
Request: `GET /sheets/layout`
Result: `403 Forbidden` (Expected without auth token).
This endpoint returns the JSON structure previously generated by the script.

### Layout Generation
Script: `python3 scripts/generate_omr_layout.py`
Result: Successfully generated `omr-layout.json` (superseded by API).
